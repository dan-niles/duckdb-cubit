# name: cubit.test
# description: Test CUBIT index on INTEGER and VARCHAR columns
# group: [cubit]

require cubit

# ---------------------
# INTEGER INDEX TEST
# ---------------------
statement ok
CREATE TABLE t(i INTEGER);

statement ok
INSERT INTO t VALUES (1), (1), (2), (2), (3);

statement ok
CREATE INDEX cubit_idx_int ON t USING CUBIT(i);

# Should return only the rows where i = 2
query II
SELECT rowid, i FROM t WHERE i = 2 ORDER BY rowid;
----
2	2
3	2

# Delete rows where i = 2
statement ok
DELETE FROM t WHERE i = 2;

# Verify deletion
query I
SELECT i FROM t ORDER BY rowid;
----
1
1
3

# ---------------------
# VARCHAR INDEX TEST
# ---------------------
statement ok
CREATE TABLE v (id INTEGER, j VARCHAR);

statement ok
INSERT INTO v VALUES (1, 'alice'), (2, 'bob'), (3, 'carol'), (4, 'carol'), (5, 'bob');

statement ok
CREATE INDEX cubit_idx_varchar ON v USING CUBIT(j);

# Should return only rows where j = 'bob'
query II
SELECT id, j FROM v WHERE j = 'bob' ORDER BY id;
----
2	bob
5	bob

# Delete rows where j = 'bob'
statement ok
DELETE FROM v WHERE j = 'bob';

# Verify deletion
query II
SELECT id, j FROM v ORDER BY id;
----
1	alice
3	carol
4	carol
